<!DOCTYPE html>
<html lang="pt-br">
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="ie=edge">
        <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
        <title>Forte do brum</title>
        <link rel="shortcut icon" href="ico/favicon.ico">
        <!-- CSS -->
        <link href="css/main.css?vs=01" rel="stylesheet">
        <link href="css/preloader.css?vs=01" rel="stylesheet">
        <!-- JS -->
        <script src="https://aframe.io/releases/1.0.4/aframe.min.js"></script>
        <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
        <script src="https://raw.githack.com/donmccurdy/aframe-extras/master/dist/aframe-extras.loaders.min.js"></script>
        <script src="https://raw.githack.com/AR-js-org/studio-backend/master/src/modules/marker/tools/gesture-detector.js"></script>
        <script src="https://raw.githack.com/AR-js-org/studio-backend/master/src/modules/marker/tools/gesture-handler.js"></script>
        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    </head>
    <body style="margin: 0; overflow: hidden;font-family: monospace;">
        <!-- preloader -->
        <div id="preloader">
            <div class="loder-box">
                <div class='loader'></br>Carregando...</div>
            </div>
        </div>
        <!--end preloader -->
        <a-scene
            vr-mode-ui="enabled: false;"
            loading-screen="enabled: false;"
            renderer="logarithmicDepthBuffer: true;"
            arjs="trackingMethod: best; sourceType: webcam; debugUIEnabled: false;"
            id="scene"
            embedded
            gesture-detector
        >
        <!-- Lista de assets -->
            <a-assets timeout="10000">
                <a-asset-item id="animated-asset-01" src="assets/01/01.gltf"></a-asset-item>
                <a-asset-item id="animated-asset-02" src="assets/02/02.gltf" ></a-asset-item>
                <a-asset-item id="animated-asset-03" src="assets/03/03.gltf" ></a-asset-item>
                <audio id="sound01" src="fortebrum/assets/01/01.mp3" preload="auto"></audio>
                <audio id="sound02" src="fortebrum/assets/02/02.mp3" preload="auto"></audio>
                <audio id="sound03" src="fortebrum/assets/03/03.mp3" preload="auto"></audio>
            </a-assets>
            <!-- Fim Lista de assets -->

            <!-- Lista de marcadores -->
            <a-marker
                id="animated-marker-01"
                type="pattern"
                preset="custom"
                url="fortebrum/assets/01/marker.patt"
                raycaster="objects: .clickable"
                emitevents="true"
                cursor="fuse: false; rayOrigin: mouse;"
                soundhandler
            >
                <a-entity
                    sound="src: #sound01" autoplay="false"
                    position="0 0.10 0"
                    rotation="-20 0 0"
                    heigth="3"
                    width="1.5"
                    id="bowser-model"
                    scale="1 1 1"
                    animation-mixer="loop: repeat"
                    gltf-model="#animated-asset-01"
                    class="clickable"
                    gesture-handler
                ></a-entity>
            </a-marker>
            <a-marker
                id="animated-marker-02"
                type="pattern"
                preset="custom"
                url="fortebrum/assets/02/marker.patt"
                raycaster="objects: .clickable"
                emitevents="true"
                cursor="fuse: false; rayOrigin: mouse;"
                soundhandler
            >
                <a-entity
                    sound="src: #sound02" autoplay="false"
                    position="0 0 0"
                    rotation="-20 0 0"
                    heigth="3"
                    width="1.5"
                    id="bowser-model"
                    scale="1 1 1"
                    animation-mixer="loop: repeat"
                    gltf-model="#animated-asset-02"
                    class="clickable"
                    gesture-handler
                ></a-entity>
            </a-marker>
            <a-marker
                id="animated-marker-03"
                type="pattern"
                preset="custom"
                url="fortebrum/assets/03/marker.patt"
                raycaster="objects: .clickable"
                emitevents="true"
                cursor="fuse: false; rayOrigin: mouse;"
                soundhandler
            >
                <a-entity
                    sound="src: #sound03" autoplay="false"
                    position="0 0 0"
                    rotation="-20 0 0"
                    heigth="3"
                    width="1.5"
                    id="bowser-model"
                    scale="1 1 1"
                    animation-mixer="loop: repeat"
                    gltf-model="#animated-asset-03"
                    class="clickable"
                    gesture-handler
                ></a-entity>
            </a-marker>
			
            <!-- Fim Lista de marcadores -->
            <a-entity camera></a-entity>
        </a-scene>
        <div id="helpMenu" data-toggle="modal" data-target="#popup">?</div>
        <div id="language">	
            <a class="language-selector active" data-lang="pt-BR">
                <img src="images/pt-BR.png" alt="Português">
            </a>
            <a class="language-selector" data-lang="en-US">
                <img src="images/en-US.png" alt="English">
            </a>
        </div>
        <div id="popup" class="modal fade popup" role="dialog">
            <div class="wrapper">
                <h2 class="popup-title">Instruções</h2>
                <div class="popup-content">
                    <p>Seja bem vindo(a)!
                        Use a câmera do Celular para interagir com nossos personagens, apontando-a para MARCADORES, espalhados pelo salão.
                    </p>
                </div>
                <div class="extra-content"></div>
                <a class="close" data-dismiss="modal" id="closePopup"> X Fechar</a>
            </div>
        </div>
        <div id="popupnext" class="modal fade popup" role="dialog">
            <div class="wrapper">
                <h2 class="popup-title">Instruções</h2>
                <div class="popup-content">
                    <p>Vá para o próximo marcador!
                    </p>
                </div>
                <a class="close" data-dismiss="modal"> X Fechar</a>
            </div>
        </div>
        <script>
            AFRAME.registerComponent('soundhandler', {
                init: function () {
                    var elem    = false;
                    var entity  = document.querySelector('[sound]');
                    var soundComponent = entity.components.sound;
                    soundComponent.pauseSound();
                },
                tick: function () {
                    
                    var entity  = document.querySelector('[sound]');
                    var id_1    = document.getElementById('animated-marker-01');
                    var id_2    = document.getElementById('animated-marker-02');
                    var id_3    = document.getElementById('animated-marker-03');
                    
                    if (id_1.object3D.visible == true) {
                        if(!elem){
                            elem = true;
                            entity = id_1.querySelector('[sound]');
                            soundComponent = entity.components.sound;
                            soundComponent.playSound();
                            setTimeout(function(){
                               $('#popupnext').modal('show');
                               id_1.setAttribute('visible', false);
                               //id_1.object3D.visible = false;
                            }, 54000);
                        }
                    } else if(id_2.object3D.visible == true) {
                        if(!elem){
                            elem = true;
                            entity = id_2.querySelector('[sound]');
                            soundComponent = entity.components.sound;
                            soundComponent.playSound();
                            setTimeout(function(){
                               $('#popupnext').modal('show');
                               id_2.setAttribute('visible', false);
                               //id_1.object3D.visible = false;
                            }, 10000);
                        }
                    }else if(id_3.object3D.visible == true) {
                        if(!elem){
                            elem = true;
                            entity = id_3.querySelector('[sound]');
                            soundComponent = entity.components.sound;
                            soundComponent.playSound();
                            setTimeout(function(){
                               $('#popupnext').modal('show');
                               id_3.setAttribute('visible', false);
                               //id_1.object3D.visible = false;
                            }, 10000);
                        }
                    } else {
                        elem = false;
                        //entity.components.sound.pauseSound();
                    }
                }
            });
        </script>
        <script>	
            $(document).ready(function() {
               $('#popup').modal('show');
            });
        </script>
        <script>
            /* ========================================================================= */
            /*	Preloader
            /* ========================================================================= */

            $(document).ready(function() {

                setTimeout(function(){$("#preloader").fadeOut("slow")}, 8000);

            });
        </script>
    </body>
</html>